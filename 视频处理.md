# Video Processing Service Flow

## Overview
The Video Processing Service handles video decoding and validation, preparing videos for frame extraction. This service focuses on essential processing steps without unnecessary complexity.

## Business Flow

```mermaid
graph LR
    A[Receive Video] --> B[Validate Video Format]
    B --> C[Decode Video]
    C --> D[Output Validated Data]
    D --> E[Notify Frame Extraction Service]
```

## Detailed Steps

### 1. Receive Video
- Receives video from cabin-sentry-service
- Video is in MP4 format, approximately 30 seconds long
- Video may come from various sources, not necessarily S3

### 2. Validate Video Format
- Simple validation to confirm the video is in a supported format (MP4)
- Check for basic file integrity
- No frame rate validation required

### 3. Decode Video
- Use JavaCV with FFmpeg for efficient video decoding
- Convert video into a format suitable for frame extraction
- Handle any codec-specific requirements

### 4. Output Validated Data
- Prepare decoded video data for frame extraction
- Generate metadata about the video (duration, dimensions, etc.)
- Package data in a format that Frame Extraction Service can consume

### 5. Notify Frame Extraction Service
- Send notification that video processing is complete
- Include references to the processed video data
- Trigger the frame extraction workflow

## Technical Implementation

### Video Decoding Solution
- Uses JavaCV with FFmpeg for robust video processing
- Provides efficient and reliable MP4 video decoding
- Handles various video specifications:
  - Format: MP4
  - Duration: ~30 seconds (15s before/after event)
  - Frame Rate: 30 fps
  - Bitrate: 5 Mbps (target) or 10 Mbps (optional)

### Processing Approach
- Stream-based processing to minimize memory usage
- No need to load entire video into memory
- Process video in chunks as needed

### Error Handling
- Graceful handling of corrupted or invalid videos
- Logging of processing errors for troubleshooting
- Retry mechanisms for transient failures
